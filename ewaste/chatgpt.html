<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E-Waste Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans">

<div id="chatbot-html-container">
  <div id="chat-widget-container" class="fixed bottom-0 right-0 w-full max-w-md mx-auto bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col h-[70vh] z-40">
    <div class="flex flex-col flex-grow overflow-hidden">
      <div class="bg-blue-600 text-white p-4 flex items-center justify-between">
        <h1 class="text-xl font-bold">E-Waste Assistant</h1>
      </div>
      <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 bg-gray-100">
        <div class="flex items-start">
          <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">AI</div>
          <div class="ml-3 bg-white p-3 rounded-xl max-w-[80%] shadow-sm">
            <p class="text-sm text-gray-800">Hello! How can I help you with e-waste management today?</p>
          </div>
        </div>
      </div>
      <div class="p-4 bg-gray-50 border-t border-gray-200">
        <div class="flex items-center justify-center mb-2">
          <button id="summary-button" class="bg-gray-200 px-4 py-2 rounded-full">âœ¨ Summarize</button>
        </div>
        <div class="flex items-center space-x-2">
          <input id="user-input" type="text" placeholder="Type your message..." class="flex-grow p-3 rounded-full border border-gray-300 focus:outline-none">
          <button id="send-button" class="bg-blue-600 text-white p-3 rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M3.5 2.4a.75.75 0 0 0-.9.94l2.4 7.9H13.5a.75.75 0 0 1 0 1.5H5l-2.4 7.9a.75.75 0 0 0 .9.94 60.5 60.5 0 0 0 18.4-9a.75.75 0 0 0 0-1.2 60.5 60.5 0 0 0-18.4-9Z" /></svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const chatAPI_KEY = "AIzaSyDbZ49WeCSeITTlvMAGHLL5a52K8R6vDWw";
  const chatAPI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + chatAPI_KEY;

  const chatMessages = document.getElementById('chat-messages');
  const userInput = document.getElementById('user-input');
  const sendButton = document.getElementById('send-button');
  const summaryButton = document.getElementById('summary-button');

  function appendMessage(sender, text) {
    const messageContainer = document.createElement('div');
    messageContainer.classList.add('flex', 'items-start');
    const avatar = document.createElement('div');
    avatar.classList.add('flex-shrink-0','w-8','h-8','rounded-full','flex','items-center','justify-center','font-bold','text-sm');
    const messageBubble = document.createElement('div');
    messageBubble.classList.add('p-3','rounded-xl','max-w-[80%]','shadow-sm');
    if (sender === 'user') {
      messageContainer.classList.add('justify-end');
      avatar.classList.add('order-2','ml-3','bg-gray-400','text-white');
      avatar.innerText = 'You';
      messageBubble.classList.add('order-1','bg-blue-500','text-white');
    } else {
      avatar.classList.add('bg-blue-500','text-white');
      avatar.innerText = 'AI';
      messageBubble.classList.add('ml-3','bg-white','text-gray-800');
    }
    messageBubble.innerHTML = `<p class="text-sm">${text.replace(/\n/g,'<br>')}</p>`;
    messageContainer.appendChild(messageBubble);
    messageContainer.appendChild(avatar);
    chatMessages.appendChild(messageContainer);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  async function sendMessage(isSummaryRequest = false) {
    const userMessage = userInput.value.trim();
    if (userMessage === '' && !isSummaryRequest) return;
    if (!isSummaryRequest) {
      appendMessage('user', userMessage);
      userInput.value = '';
    }
    const payload = { contents: [{ role:'user', parts:[{ text:userMessage }] }] };
    try {
      const response = await fetch(chatAPI_URL, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body:JSON.stringify(payload)
      });
      const result = await response.json();
      const aiResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: No response.";
      appendMessage('ai', aiResponse);
    } catch (error) {
      appendMessage('ai', "Error connecting to Gemini API.");
    }
  }

  sendButton.addEventListener('click', () => sendMessage(false));
  summaryButton.addEventListener('click', () => sendMessage(true));
  userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(false); });
</script>

</body>
</html>
